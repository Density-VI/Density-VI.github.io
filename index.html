<!DOCTYPE html>
<html>
<head>
<title>Escape Room</title>

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #111;
    color: white;
    text-align: center;
    margin: 0;
}
.room { padding: 40px; }
.hidden { display:none; }
input, button { padding:10px; margin:10px; }

#passedScreen {
    display:none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:black;
    color:lime;
    font-size:70px;
    font-weight:bold;
    justify-content:center;
    align-items:center;
}

#timerDisplay{
    font-size:22px;
    color:cyan;
}

table {
    margin:20px auto;
    border-collapse: collapse;
    width:60%;
}
th, td {
    border:1px solid white;
    padding:10px;
}
th {
    background:#333;
}
</style>
</head>

<body>

<!-- START PAGE -->
<div id="startPage" class="room">
    <h1>Escape Room Challenge</h1>
    <p>Enter your email to begin:</p>
    <input type="email" id="loginEmail" placeholder="Your Email">
    <br>
    <button onclick="beginGame()">START GAME</button>
    <br><br>
    <button onclick="showLeaderboard()">View Leaderboard</button>
</div>

<div id="timerDisplay" class="hidden">Time: 0.00s</div>

<!-- ROOM 1 -->
<div id="room1" class="room hidden">
    <h1>Escape Room - Room 1</h1>
    <p>There are many things you can click...</p>

    <a href="https://www.bing.com/videos/riverview/relatedvideo?q=rick+aslty+never" target="_blank">
        Click Me I Dare You
    </a>

    <p>Enter the secret code:</p>
    <input type="text" placeholder="Type something...">

    <p>
    <button onclick="alert('if the answer is what you seek you must mute and find peace')">
        Strange Button
    </button>
    </p>
</div>

<div id="passedScreen">YOU PASSED</div>

<!-- FINISH PAGE -->
<div id="finishPage" class="room hidden">
    <h1>YOU ESCAPED</h1>
    <h2 id="finalTime"></h2>
    <button onclick="saveScore()">Save Score</button>
</div>

<!-- LEADERBOARD PAGE -->
<div id="leaderboardPage" class="room hidden">
    <h1>üèÜ Leaderboard (Top 10)</h1>
    <table id="leaderboardTable">
        <tr>
            <th>Rank</th>
            <th>Email</th>
            <th>Time (s)</th>
        </tr>
    </table>
    <br>
    <button onclick="goHome()">Back</button>
</div>

<script>
let playerEmail="";
let startTime;
let timerInterval;
let inactivityTimer;

/* ---------- START ---------- */

function beginGame(){
    const emailInput=document.getElementById("loginEmail").value;
    if(!emailInput){
        alert("Enter your email first.");
        return;
    }

    playerEmail=emailInput;

    document.getElementById("startPage").classList.add("hidden");
    document.getElementById("room1").classList.remove("hidden");
    document.getElementById("timerDisplay").classList.remove("hidden");

    startTime=Date.now();
    timerInterval=setInterval(updateTimer,10);

    resetIdleTimer();
}

/* ---------- TIMER ---------- */

function updateTimer(){
    let elapsed=(Date.now()-startTime)/1000;
    document.getElementById("timerDisplay").innerText=
        "Time: "+elapsed.toFixed(2)+"s";
}

function stopTimer(){
    clearInterval(timerInterval);
    return ((Date.now()-startTime)/1000).toFixed(2);
}

/* ---------- ROOM 1 WIN ---------- */

function resetIdleTimer(){
    clearTimeout(inactivityTimer);
    inactivityTimer=setTimeout(winGame,30000);
}

document.addEventListener("mousemove",resetIdleTimer);
document.addEventListener("keypress",resetIdleTimer);
document.addEventListener("click",resetIdleTimer);

function winGame(){
    document.getElementById("passedScreen").style.display="flex";

    setTimeout(()=>{
        document.getElementById("passedScreen").style.display="none";
        document.getElementById("room1").classList.add("hidden");
        document.getElementById("finishPage").classList.remove("hidden");

        let finalTime=stopTimer();
        window.playerScore=finalTime;

        document.getElementById("finalTime").innerText=
            "Your Time: "+finalTime+" seconds";
    },3000);
}

/* ---------- LEADERBOARD ---------- */

function saveScore(){
    let scores=JSON.parse(localStorage.getItem("escapeScores")) || [];

    scores.push({
        email:playerEmail,
        time:parseFloat(window.playerScore)
    });

    scores.sort((a,b)=>a.time-b.time);
    scores=scores.slice(0,10);

    localStorage.setItem("escapeScores",JSON.stringify(scores));

    showLeaderboard();
}

function showLeaderboard(){
    document.querySelectorAll(".room").forEach(r=>r.classList.add("hidden"));
    document.getElementById("leaderboardPage").classList.remove("hidden");

    const table=document.getElementById("leaderboardTable");

    table.innerHTML=`
        <tr>
            <th>Rank</th>
            <th>Email</th>
            <th>Time (s)</th>
        </tr>
    `;

    let scores=JSON.parse(localStorage.getItem("escapeScores")) || [];

    scores.forEach((score,index)=>{
        table.innerHTML+=`
            <tr>
                <td>${index+1}</td>
                <td>${score.email}</td>
                <td>${score.time.toFixed(2)}</td>
            </tr>
        `;
    });
}

function goHome(){
    document.querySelectorAll(".room").forEach(r=>r.classList.add("hidden"));
    document.getElementById("startPage").classList.remove("hidden");
}
</script>

</body>
</html>




